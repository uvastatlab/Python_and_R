<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Aggregation and Group Operations | Python and R</title>
  <meta name="description" content="This book provides parallel code examples in Python and R to help analysts and researchers translate between and learn the languages." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Aggregation and Group Operations | Python and R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book provides parallel code examples in Python and R to help analysts and researchers translate between and learn the languages." />
  <meta name="github-repo" content="uvastatlab/Python_and_R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Aggregation and Group Operations | Python and R" />
  
  <meta name="twitter:description" content="This book provides parallel code examples in Python and R to help analysts and researchers translate between and learn the languages." />
  

<meta name="author" content="Clay Ford, Jacob Goldstein-Greenwood, Oyinkansola Adenekan, Samantha Lomuscio" />


<meta name="date" content="2023-06-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="combine-reshape-and-merge.html"/>
<link rel="next" href="basic-plotting-and-visualization.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Python and R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>1</b> Basics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="basics.html"><a href="basics.html#math"><i class="fa fa-check"></i><b>1.1</b> Math</a></li>
<li class="chapter" data-level="1.2" data-path="basics.html"><a href="basics.html#missing-values"><i class="fa fa-check"></i><b>1.2</b> Missing values</a></li>
<li class="chapter" data-level="1.3" data-path="basics.html"><a href="basics.html#assignment"><i class="fa fa-check"></i><b>1.3</b> Assignment</a></li>
<li class="chapter" data-level="1.4" data-path="basics.html"><a href="basics.html#printing-a-value"><i class="fa fa-check"></i><b>1.4</b> Printing a value</a></li>
<li class="chapter" data-level="1.5" data-path="basics.html"><a href="basics.html#packages"><i class="fa fa-check"></i><b>1.5</b> Packages</a></li>
<li class="chapter" data-level="1.6" data-path="basics.html"><a href="basics.html#logic"><i class="fa fa-check"></i><b>1.6</b> Logic</a></li>
<li class="chapter" data-level="1.7" data-path="basics.html"><a href="basics.html#generating-a-sequence-of-values"><i class="fa fa-check"></i><b>1.7</b> Generating a sequence of values</a></li>
<li class="chapter" data-level="1.8" data-path="basics.html"><a href="basics.html#calculating-means-and-medians"><i class="fa fa-check"></i><b>1.8</b> Calculating means and medians</a></li>
<li class="chapter" data-level="1.9" data-path="basics.html"><a href="basics.html#writing-your-own-functions"><i class="fa fa-check"></i><b>1.9</b> Writing your own functions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Data Structures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#one-dimensional-data"><i class="fa fa-check"></i><b>2.1</b> One-dimensional data</a></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#two-dimensional-data"><i class="fa fa-check"></i><b>2.2</b> Two-dimensional data</a></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#three-dimensional-and-higher-data"><i class="fa fa-check"></i><b>2.3</b> Three-dimensional and higher data</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#general-data-structures"><i class="fa fa-check"></i><b>2.4</b> General data structures</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="import-export-and-save-data.html"><a href="import-export-and-save-data.html"><i class="fa fa-check"></i><b>3</b> Import, Export, and Save Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="import-export-and-save-data.html"><a href="import-export-and-save-data.html#csv"><i class="fa fa-check"></i><b>3.1</b> CSV</a></li>
<li class="chapter" data-level="3.2" data-path="import-export-and-save-data.html"><a href="import-export-and-save-data.html#xlsxlsx-excel"><i class="fa fa-check"></i><b>3.2</b> XLS/XLSX (Excel)</a></li>
<li class="chapter" data-level="3.3" data-path="import-export-and-save-data.html"><a href="import-export-and-save-data.html#json"><i class="fa fa-check"></i><b>3.3</b> JSON</a></li>
<li class="chapter" data-level="3.4" data-path="import-export-and-save-data.html"><a href="import-export-and-save-data.html#xml"><i class="fa fa-check"></i><b>3.4</b> XML</a></li>
<li class="chapter" data-level="3.5" data-path="import-export-and-save-data.html"><a href="import-export-and-save-data.html#exportingwritingsaving-data-and-variables"><i class="fa fa-check"></i><b>3.5</b> Exporting/Writing/Saving data and variables</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>4</b> Data Manipulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-manipulation.html"><a href="data-manipulation.html#view-variable-names-and-types"><i class="fa fa-check"></i><b>4.1</b> View variable names and types</a></li>
<li class="chapter" data-level="4.2" data-path="data-manipulation.html"><a href="data-manipulation.html#select-variables"><i class="fa fa-check"></i><b>4.2</b> Select variables</a></li>
<li class="chapter" data-level="4.3" data-path="data-manipulation.html"><a href="data-manipulation.html#filtersubset-variables"><i class="fa fa-check"></i><b>4.3</b> Filter/Subset variables</a></li>
<li class="chapter" data-level="4.4" data-path="data-manipulation.html"><a href="data-manipulation.html#rename-variables"><i class="fa fa-check"></i><b>4.4</b> Rename variables</a></li>
<li class="chapter" data-level="4.5" data-path="data-manipulation.html"><a href="data-manipulation.html#create-replace-and-remove-variables"><i class="fa fa-check"></i><b>4.5</b> Create, replace and remove variables</a></li>
<li class="chapter" data-level="4.6" data-path="data-manipulation.html"><a href="data-manipulation.html#create-strings-from-numbers"><i class="fa fa-check"></i><b>4.6</b> Create strings from numbers</a></li>
<li class="chapter" data-level="4.7" data-path="data-manipulation.html"><a href="data-manipulation.html#create-numbers-from-strings"><i class="fa fa-check"></i><b>4.7</b> Create numbers from strings</a></li>
<li class="chapter" data-level="4.8" data-path="data-manipulation.html"><a href="data-manipulation.html#combine-strings"><i class="fa fa-check"></i><b>4.8</b> Combine strings</a></li>
<li class="chapter" data-level="4.9" data-path="data-manipulation.html"><a href="data-manipulation.html#finding-and-replacing-patterns-within-strings"><i class="fa fa-check"></i><b>4.9</b> Finding and replacing patterns within strings</a></li>
<li class="chapter" data-level="4.10" data-path="data-manipulation.html"><a href="data-manipulation.html#change-case"><i class="fa fa-check"></i><b>4.10</b> Change case</a></li>
<li class="chapter" data-level="4.11" data-path="data-manipulation.html"><a href="data-manipulation.html#drop-duplicate-rows"><i class="fa fa-check"></i><b>4.11</b> Drop duplicate rows</a></li>
<li class="chapter" data-level="4.12" data-path="data-manipulation.html"><a href="data-manipulation.html#format-dates"><i class="fa fa-check"></i><b>4.12</b> Format dates</a></li>
<li class="chapter" data-level="4.13" data-path="data-manipulation.html"><a href="data-manipulation.html#randomly-sample-rows"><i class="fa fa-check"></i><b>4.13</b> Randomly sample rows</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html"><i class="fa fa-check"></i><b>5</b> Combine, Reshape and Merge</a>
<ul>
<li class="chapter" data-level="5.1" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#combine-rows"><i class="fa fa-check"></i><b>5.1</b> Combine rows</a></li>
<li class="chapter" data-level="5.2" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#combine-columns"><i class="fa fa-check"></i><b>5.2</b> Combine columns</a></li>
<li class="chapter" data-level="5.3" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#reshaping-data"><i class="fa fa-check"></i><b>5.3</b> Reshaping data</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#wide-to-long"><i class="fa fa-check"></i><b>5.3.1</b> Wide to long</a></li>
<li class="chapter" data-level="5.3.2" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#long-to-wide"><i class="fa fa-check"></i><b>5.3.2</b> Long to wide</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#mergejoin"><i class="fa fa-check"></i><b>5.4</b> Merge/Join</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#left-join"><i class="fa fa-check"></i><b>5.4.1</b> Left Join</a></li>
<li class="chapter" data-level="5.4.2" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#right-join"><i class="fa fa-check"></i><b>5.4.2</b> Right Join</a></li>
<li class="chapter" data-level="5.4.3" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#inner-join"><i class="fa fa-check"></i><b>5.4.3</b> Inner Join</a></li>
<li class="chapter" data-level="5.4.4" data-path="combine-reshape-and-merge.html"><a href="combine-reshape-and-merge.html#outer-join"><i class="fa fa-check"></i><b>5.4.4</b> Outer Join</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="aggregation-and-group-operations.html"><a href="aggregation-and-group-operations.html"><i class="fa fa-check"></i><b>6</b> Aggregation and Group Operations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="aggregation-and-group-operations.html"><a href="aggregation-and-group-operations.html#cross-tabulation"><i class="fa fa-check"></i><b>6.1</b> Cross tabulation</a></li>
<li class="chapter" data-level="6.2" data-path="aggregation-and-group-operations.html"><a href="aggregation-and-group-operations.html#group-summaries"><i class="fa fa-check"></i><b>6.2</b> Group summaries</a></li>
<li class="chapter" data-level="6.3" data-path="aggregation-and-group-operations.html"><a href="aggregation-and-group-operations.html#centering-and-scaling"><i class="fa fa-check"></i><b>6.3</b> Centering and Scaling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="basic-plotting-and-visualization.html"><a href="basic-plotting-and-visualization.html"><i class="fa fa-check"></i><b>7</b> Basic Plotting and Visualization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="basic-plotting-and-visualization.html"><a href="basic-plotting-and-visualization.html#histograms"><i class="fa fa-check"></i><b>7.1</b> Histograms</a></li>
<li class="chapter" data-level="7.2" data-path="basic-plotting-and-visualization.html"><a href="basic-plotting-and-visualization.html#barplots"><i class="fa fa-check"></i><b>7.2</b> Barplots</a></li>
<li class="chapter" data-level="7.3" data-path="basic-plotting-and-visualization.html"><a href="basic-plotting-and-visualization.html#scatterplot"><i class="fa fa-check"></i><b>7.3</b> Scatterplot</a></li>
<li class="chapter" data-level="7.4" data-path="basic-plotting-and-visualization.html"><a href="basic-plotting-and-visualization.html#stripcharts"><i class="fa fa-check"></i><b>7.4</b> Stripcharts</a></li>
<li class="chapter" data-level="7.5" data-path="basic-plotting-and-visualization.html"><a href="basic-plotting-and-visualization.html#boxplots"><i class="fa fa-check"></i><b>7.5</b> Boxplots</a></li>
<li class="chapter" data-level="7.6" data-path="basic-plotting-and-visualization.html"><a href="basic-plotting-and-visualization.html#facet-plots"><i class="fa fa-check"></i><b>7.6</b> Facet plots</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="selected-topics-in-statistical-inference.html"><a href="selected-topics-in-statistical-inference.html"><i class="fa fa-check"></i><b>8</b> Selected Topics in Statistical Inference</a>
<ul>
<li class="chapter" data-level="8.1" data-path="selected-topics-in-statistical-inference.html"><a href="selected-topics-in-statistical-inference.html#comparing-group-means"><i class="fa fa-check"></i><b>8.1</b> Comparing group means</a></li>
<li class="chapter" data-level="8.2" data-path="selected-topics-in-statistical-inference.html"><a href="selected-topics-in-statistical-inference.html#comparing-group-proportions"><i class="fa fa-check"></i><b>8.2</b> Comparing group proportions</a></li>
<li class="chapter" data-level="8.3" data-path="selected-topics-in-statistical-inference.html"><a href="selected-topics-in-statistical-inference.html#linear-modeling"><i class="fa fa-check"></i><b>8.3</b> Linear modeling</a></li>
<li class="chapter" data-level="8.4" data-path="selected-topics-in-statistical-inference.html"><a href="selected-topics-in-statistical-inference.html#logistic-regression"><i class="fa fa-check"></i><b>8.4</b> Logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Python and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="aggregation-and-group-operations" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Aggregation and Group Operations<a href="aggregation-and-group-operations.html#aggregation-and-group-operations" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter looks at manipulating and summarizing data by groups.</p>
<div id="cross-tabulation" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Cross tabulation<a href="aggregation-and-group-operations.html#cross-tabulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cross tabulation is the process of determining frequencies per group (or determining values based on frequencies, like proportions), with groups defined by one or more variables (e.g., nationality and sex).</p>
<p>The Python and R examples of cross tabulation below both make use of the following data set, <code>dat</code>:</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="aggregation-and-group-operations.html#cb585-1" tabindex="-1"></a>dat</span></code></pre></div>
<pre><code>##   nationality sex
## 1    Canadian   m
## 2      French   f
## 3      French   f
## 4    Egyptian   m
## 5    Canadian   f</code></pre>
<div id="python-38" class="section level4 unnumbered hasAnchor">
<h4>Python<a href="aggregation-and-group-operations.html#python-38" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <strong>pandas</strong> package contains a <code>crosstab()</code> function for cross tabulation with two or more variables. Alternatively, the <code>groupby()</code> function, also in <strong>pandas</strong>, facilitates cross tabulation by one or more variables when used in combination with <code>count()</code>.</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb587-1"><a href="aggregation-and-group-operations.html#cb587-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb587-2"><a href="aggregation-and-group-operations.html#cb587-2" tabindex="-1"></a>pd.crosstab(dat.nationality, dat.sex)</span></code></pre></div>
<pre><code>## sex          f  m
## nationality      
## Canadian     1  1
## Egyptian     0  1
## French       2  0</code></pre>
<div class="sourceCode" id="cb589"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb589-1"><a href="aggregation-and-group-operations.html#cb589-1" tabindex="-1"></a>dat.groupby(by <span class="op">=</span> <span class="st">&#39;nationality&#39;</span>).nationality.count()</span></code></pre></div>
<pre><code>## nationality
## Canadian    2
## Egyptian    1
## French      2
## Name: nationality, dtype: int64</code></pre>
<div class="sourceCode" id="cb591"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb591-1"><a href="aggregation-and-group-operations.html#cb591-1" tabindex="-1"></a>dat.groupby(by <span class="op">=</span> [<span class="st">&#39;nationality&#39;</span>, <span class="st">&#39;sex&#39;</span>]).nationality.count()</span></code></pre></div>
<pre><code>## nationality  sex
## Canadian     f      1
##              m      1
## Egyptian     m      1
## French       f      2
## Name: nationality, dtype: int64</code></pre>
<div class="sourceCode" id="cb593"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb593-1"><a href="aggregation-and-group-operations.html#cb593-1" tabindex="-1"></a><span class="co"># Or: dat.groupby(by = [&#39;nationality&#39;, &#39;sex&#39;]).sex.count()</span></span></code></pre></div>
</div>
<div id="r-38" class="section level4 unnumbered hasAnchor">
<h4>R<a href="aggregation-and-group-operations.html#r-38" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>table()</code> function performs cross tabulation in R. A user can enter a single grouping variable or enter multiple grouping variables separated by a comma(s). The <code>xtabs()</code> function also computes cross-tabs; a user enters the variables to be used for grouping in formula notation.</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="aggregation-and-group-operations.html#cb594-1" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>nationality)</span></code></pre></div>
<pre><code>## 
## Canadian Egyptian   French 
##        2        1        2</code></pre>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="aggregation-and-group-operations.html#cb596-1" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>nationality, dat<span class="sc">$</span>sex)</span></code></pre></div>
<pre><code>##           
##            f m
##   Canadian 1 1
##   Egyptian 0 1
##   French   2 0</code></pre>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="aggregation-and-group-operations.html#cb598-1" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="at">formula =</span> <span class="sc">~</span>nationality <span class="sc">+</span> sex, <span class="at">data =</span> dat)</span></code></pre></div>
<pre><code>##            sex
## nationality f m
##    Canadian 1 1
##    Egyptian 0 1
##    French   2 0</code></pre>
</div>
</div>
<div id="group-summaries" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Group summaries<a href="aggregation-and-group-operations.html#group-summaries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Computing statistical summaries per group.</p>
<div id="python-39" class="section level4 unnumbered hasAnchor">
<h4>Python<a href="aggregation-and-group-operations.html#python-39" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>groupby()</code> function from <strong>pandas</strong> splits up a data set based on one or more grouping variables. Summarizing functions—like <code>mean()</code>, <code>sum()</code>, and so on—can then be applied to those groups. In the first example below, we use <code>groupby()</code> to group rows of the <code>mtcars</code> data set by the number of cylinders each car has; from there, we select just the <code>mpg</code> column and call <code>mean()</code>, thus calculating the average miles per gallon within each cylinder group. In the second example, we again group observations by <code>cyl</code>, but instead of then selecting just the <code>mpg</code> column, we directly call <code>mean()</code>; this gives the mean for each variable in the data set within each cylinder group. Finally, in the third example, we group by two variables—<code>cyl</code> and <code>vs</code>—and then use the <code>describe()</code> function to generate a set of descriptive statistics for <code>mpg</code> within each <code>cylinder</code>*<code>vs</code> group (e.g., mean, SD, minimum, etc.).</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb600-1"><a href="aggregation-and-group-operations.html#cb600-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb600-2"><a href="aggregation-and-group-operations.html#cb600-2" tabindex="-1"></a></span>
<span id="cb600-3"><a href="aggregation-and-group-operations.html#cb600-3" tabindex="-1"></a>mean_mpg_by_cyl <span class="op">=</span> mtcars.groupby(by <span class="op">=</span> <span class="st">&#39;cyl&#39;</span>)[<span class="st">&#39;mpg&#39;</span>].mean()</span>
<span id="cb600-4"><a href="aggregation-and-group-operations.html#cb600-4" tabindex="-1"></a><span class="bu">print</span>(mean_mpg_by_cyl)</span></code></pre></div>
<pre><code>## cyl
## 4.0    26.663636
## 6.0    19.742857
## 8.0    15.100000
## Name: mpg, dtype: float64</code></pre>
<div class="sourceCode" id="cb602"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb602-1"><a href="aggregation-and-group-operations.html#cb602-1" tabindex="-1"></a>means_all_vars <span class="op">=</span> mtcars.groupby(by <span class="op">=</span> <span class="st">&#39;cyl&#39;</span>).mean()</span>
<span id="cb602-2"><a href="aggregation-and-group-operations.html#cb602-2" tabindex="-1"></a><span class="bu">print</span>(means_all_vars)</span></code></pre></div>
<pre><code>##            mpg        disp          hp  ...        am      gear      carb
## cyl                                     ...                              
## 4.0  26.663636  105.136364   82.636364  ...  0.727273  4.090909  1.545455
## 6.0  19.742857  183.314286  122.285714  ...  0.428571  3.857143  3.428571
## 8.0  15.100000  353.100000  209.214286  ...  0.142857  3.285714  3.500000
## 
## [3 rows x 10 columns]</code></pre>
<div class="sourceCode" id="cb604"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb604-1"><a href="aggregation-and-group-operations.html#cb604-1" tabindex="-1"></a>mpg_by_cyl_vs <span class="op">=</span> mtcars.groupby(by <span class="op">=</span> [<span class="st">&#39;cyl&#39;</span>, <span class="st">&#39;vs&#39;</span>])[<span class="st">&#39;mpg&#39;</span>].describe()</span>
<span id="cb604-2"><a href="aggregation-and-group-operations.html#cb604-2" tabindex="-1"></a><span class="bu">print</span>(mpg_by_cyl_vs)</span></code></pre></div>
<pre><code>##          count       mean       std   min     25%    50%    75%   max
## cyl vs                                                               
## 4.0 0.0    1.0  26.000000       NaN  26.0  26.000  26.00  26.00  26.0
##     1.0   10.0  26.730000  4.748111  21.4  22.800  25.85  30.40  33.9
## 6.0 0.0    3.0  20.566667  0.750555  19.7  20.350  21.00  21.00  21.0
##     1.0    4.0  19.125000  1.631717  17.8  18.025  18.65  19.75  21.4
## 8.0 0.0   14.0  15.100000  2.560048  10.4  14.400  15.20  16.25  19.2</code></pre>
</div>
<div id="r-39" class="section level4 unnumbered hasAnchor">
<h4>R<a href="aggregation-and-group-operations.html#r-39" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>aggregate()</code> function can be used to generate by-group statistical summaries based on one or more grouping variables. Grouping variables can be declared as a list in the function’s <code>by</code> argument. Alternatively, the grouping variable(s) and the variable to be summarized can be passed to <code>aggregate()</code> in formula notation: <code>var_to_be_aggregated ~ grouping_var_1 + ... + grouping_var_N</code>. The summarizing function (e.g., <code>mean()</code>; <code>median()</code>; etc.) is declared in the <code>FUN</code> argument.</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="aggregation-and-group-operations.html#cb606-1" tabindex="-1"></a><span class="co"># One grouping variable</span></span>
<span id="cb606-2"><a href="aggregation-and-group-operations.html#cb606-2" tabindex="-1"></a><span class="co"># Calculating mean of `mpg` in each `cyl` group</span></span>
<span id="cb606-3"><a href="aggregation-and-group-operations.html#cb606-3" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="at">x =</span> mtcars<span class="sc">$</span>mpg, </span>
<span id="cb606-4"><a href="aggregation-and-group-operations.html#cb606-4" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">cyl =</span> mtcars<span class="sc">$</span>cyl), </span>
<span id="cb606-5"><a href="aggregation-and-group-operations.html#cb606-5" tabindex="-1"></a>          <span class="at">FUN =</span> <span class="st">&quot;mean&quot;</span>) </span></code></pre></div>
<pre><code>##   cyl        x
## 1   4 26.66364
## 2   6 19.74286
## 3   8 15.10000</code></pre>
<p>Adding <code>drop = FALSE</code> ensures that all combinations of levels are returned even if no data exist at that combination. The final row below is <code>NA</code> since there are no eight-cylinder cars with a “straight” engine (<code>vs = 1</code>).</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="aggregation-and-group-operations.html#cb608-1" tabindex="-1"></a><span class="co"># Two or more grouping variables</span></span>
<span id="cb608-2"><a href="aggregation-and-group-operations.html#cb608-2" tabindex="-1"></a><span class="co"># Calculating max of `mpg` in each `cyl`*`vs` group</span></span>
<span id="cb608-3"><a href="aggregation-and-group-operations.html#cb608-3" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="at">x =</span> mtcars<span class="sc">$</span>mpg, </span>
<span id="cb608-4"><a href="aggregation-and-group-operations.html#cb608-4" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">cyl =</span> mtcars<span class="sc">$</span>cyl, <span class="at">vs =</span> mtcars<span class="sc">$</span>vs), </span>
<span id="cb608-5"><a href="aggregation-and-group-operations.html#cb608-5" tabindex="-1"></a>          <span class="at">FUN =</span> <span class="st">&#39;max&#39;</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>) </span></code></pre></div>
<pre><code>##   cyl vs    x
## 1   4  0 26.0
## 2   6  0 21.0
## 3   8  0 19.2
## 4   4  1 33.9
## 5   6  1 21.4
## 6   8  1   NA</code></pre>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="aggregation-and-group-operations.html#cb610-1" tabindex="-1"></a><span class="co"># Or, specify the variable to summarize and the grouping variables in formula notation</span></span>
<span id="cb610-2"><a href="aggregation-and-group-operations.html#cb610-2" tabindex="-1"></a><span class="fu">aggregate</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> vs, <span class="at">data =</span> mtcars, <span class="at">FUN =</span> max)</span></code></pre></div>
<p>The <strong>tidyverse</strong> also offers a summarizing function, <code>summarize()</code> (or <code>summarise()</code>, for the Britons), which is in the <strong>dplyr</strong> package. After grouping a data frame/tibble (with, e.g., <strong>dplyr</strong>’s <code>group_by()</code> function), a user passes it to <code>summarize()</code>, specifying in the function call how the summary statistic should be calculated.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="aggregation-and-group-operations.html#cb611-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb611-2"><a href="aggregation-and-group-operations.html#cb611-2" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb611-3"><a href="aggregation-and-group-operations.html#cb611-3" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl, vs) <span class="sc">%&gt;%</span> </span>
<span id="cb611-4"><a href="aggregation-and-group-operations.html#cb611-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_mpg =</span> <span class="fu">mean</span>(mpg))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;cyl&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 5 × 3
## # Groups:   cyl [3]
##     cyl    vs avg_mpg
##   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1     4     0    26  
## 2     4     1    26.7
## 3     6     0    20.6
## 4     6     1    19.1
## 5     8     0    15.1</code></pre>
<p><code>summarize()</code> makes it easy to specify relatively complicated summary calculations without needing to write an external function.</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="aggregation-and-group-operations.html#cb614-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb614-2"><a href="aggregation-and-group-operations.html#cb614-2" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl, vs) <span class="sc">%&gt;%</span> </span>
<span id="cb614-3"><a href="aggregation-and-group-operations.html#cb614-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_mpg =</span> <span class="fu">mean</span>(mpg),</span>
<span id="cb614-4"><a href="aggregation-and-group-operations.html#cb614-4" tabindex="-1"></a>            <span class="at">complicated_summary_calculation =</span> </span>
<span id="cb614-5"><a href="aggregation-and-group-operations.html#cb614-5" tabindex="-1"></a>              <span class="fu">min</span>(mpg)<span class="sc">^</span><span class="fl">0.5</span> <span class="sc">*</span> </span>
<span id="cb614-6"><a href="aggregation-and-group-operations.html#cb614-6" tabindex="-1"></a>              <span class="fu">mean</span>(wt)<span class="sc">^</span><span class="fl">0.5</span> <span class="sc">+</span> </span>
<span id="cb614-7"><a href="aggregation-and-group-operations.html#cb614-7" tabindex="-1"></a>              <span class="fu">mean</span>(disp)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">mean</span>(hp)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;cyl&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 5 × 4
## # Groups:   cyl [3]
##     cyl    vs avg_mpg complicated_summary_calculation
##   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;                           &lt;dbl&gt;
## 1     4     0    26                              8.51
## 2     4     1    26.7                            8.07
## 3     6     0    20.6                            8.41
## 4     6     1    19.1                            8.81
## 5     8     0    15.1                            7.48</code></pre>
</div>
</div>
<div id="centering-and-scaling" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Centering and Scaling<a href="aggregation-and-group-operations.html#centering-and-scaling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>Centering</em> refers to subtracting a constant, such as the mean, from every value in a set. This is sometimes performed to aid interpretation of linear model coefficients.</p>
<p><em>Scaling</em> refers to rescaling a column or vector of values such that their mean is zero and their standard deviation is one. This is sometimes performed to put multiple variables on the same scale and is often recommended for procedures such as principal components analysis (PCA).</p>
<div id="python-40" class="section level4 unnumbered hasAnchor">
<h4>Python<a href="aggregation-and-group-operations.html#python-40" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>scale()</code> function from the <strong>preprocessing</strong> module of the <strong>scikit-learn</strong> (<strong>sklearn</strong>) package provides one-step centering and scaling. To center a variable at zero without scaling it, use <code>scale()</code> with <code>with_mean = True</code> and <code>with_std = False</code> (both are <code>True</code> by default).</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb617-1"><a href="aggregation-and-group-operations.html#cb617-1" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb617-2"><a href="aggregation-and-group-operations.html#cb617-2" tabindex="-1"></a></span>
<span id="cb617-3"><a href="aggregation-and-group-operations.html#cb617-3" tabindex="-1"></a>centered_mpg <span class="op">=</span> preprocessing.scale(mtcars.mpg, with_mean <span class="op">=</span> <span class="va">True</span>, with_std <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb617-4"><a href="aggregation-and-group-operations.html#cb617-4" tabindex="-1"></a>centered_mpg.mean()</span></code></pre></div>
<pre><code>## -3.1086244689504383e-15</code></pre>
<p>To scale a variable after centering it (so that its mean is zero and its standard deviation is one), use <code>scale()</code> with <code>with_mean = True</code> and <code>with_std = True</code>.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb619-1"><a href="aggregation-and-group-operations.html#cb619-1" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb619-2"><a href="aggregation-and-group-operations.html#cb619-2" tabindex="-1"></a></span>
<span id="cb619-3"><a href="aggregation-and-group-operations.html#cb619-3" tabindex="-1"></a>scaled_mpg <span class="op">=</span> preprocessing.scale(mtcars.mpg, with_mean <span class="op">=</span> <span class="va">True</span>, with_std <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb619-4"><a href="aggregation-and-group-operations.html#cb619-4" tabindex="-1"></a>scaled_mpg.mean()</span></code></pre></div>
<pre><code>## -4.996003610813204e-16</code></pre>
<div class="sourceCode" id="cb621"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb621-1"><a href="aggregation-and-group-operations.html#cb621-1" tabindex="-1"></a>scaled_mpg.std()</span></code></pre></div>
<pre><code>## 1.0</code></pre>
</div>
<div id="r-40" class="section level4 unnumbered hasAnchor">
<h4>R<a href="aggregation-and-group-operations.html#r-40" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>scale()</code> function can both center and scale variables.</p>
<p>To center a variable without scaling it, call <code>scale()</code> with the <code>center</code> argument set to <code>TRUE</code> and the <code>scale</code> argument set to <code>FALSE</code>. The variable’s mean will be subtracted off of each of the variable values. (Note: If desired, the <code>center</code> argument can be set to a numeric value instead of <code>TRUE</code>/<code>FALSE</code>; in that case, each variable value will have the argument value subtracted off of it.)</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="aggregation-and-group-operations.html#cb623-1" tabindex="-1"></a>centered_mpg <span class="ot">&lt;-</span> <span class="fu">scale</span>(mtcars<span class="sc">$</span>mpg, <span class="at">center =</span> T, <span class="at">scale =</span> F)</span>
<span id="cb623-2"><a href="aggregation-and-group-operations.html#cb623-2" tabindex="-1"></a><span class="fu">mean</span>(centered_mpg)</span></code></pre></div>
<pre><code>## [1] 4.440892e-16</code></pre>
<p>To scale a variable (while also centering it), call <code>scale()</code> with the <code>center</code> and <code>scale</code> arguments set to <code>TRUE</code> (these are the default argument values). The variable’s mean will be subtracted off of each of the variable values, and each value will then be divided by the variable’s standard deviation. (Note: As with the <code>center</code> argument, the <code>scale</code> argument can also be set to a numeric value instead of <code>TRUE</code>/<code>FALSE</code>; in that case, the divisor will be the argument value instead of the standard deviation.)</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="aggregation-and-group-operations.html#cb625-1" tabindex="-1"></a>scaled_mpg <span class="ot">&lt;-</span> <span class="fu">scale</span>(mtcars<span class="sc">$</span>mpg, <span class="at">center =</span> T, <span class="at">scale =</span> T)</span>
<span id="cb625-2"><a href="aggregation-and-group-operations.html#cb625-2" tabindex="-1"></a><span class="fu">mean</span>(scaled_mpg)</span></code></pre></div>
<pre><code>## [1] 7.112366e-17</code></pre>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="aggregation-and-group-operations.html#cb627-1" tabindex="-1"></a><span class="fu">sd</span>(scaled_mpg)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="combine-reshape-and-merge.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="basic-plotting-and-visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/uvastatlab/Python_and_R/edit/main/06-aggregation-and_group_operations.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
